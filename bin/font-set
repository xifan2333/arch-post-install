#!/bin/bash
# Set font for all applications
# Usage: font-set <font-name>

set -e

# Load i18n
source i18n-core

FONT_NAME="$1"

if [[ -z "$FONT_NAME" ]]; then
    exit 1
fi

# Check if font exists on the system
if ! fc-list | grep -iq "$FONT_NAME"; then
    exit 1
fi

# Sync fonts across applications
sync_fonts() {
    # Sync terminal emulators
    if command -v font-sync-alacritty >/dev/null 2>&1; then
        font-sync-alacritty "$FONT_NAME"
    fi

    if command -v font-sync-kitty >/dev/null 2>&1; then
        font-sync-kitty "$FONT_NAME"
    fi

    if command -v font-sync-ghostty >/dev/null 2>&1; then
        font-sync-ghostty "$FONT_NAME"
    fi

    # Sync GUI applications
    if command -v font-sync-waybar >/dev/null 2>&1; then
        font-sync-waybar "$FONT_NAME"
    fi

    if command -v font-sync-swayosd >/dev/null 2>&1; then
        font-sync-swayosd "$FONT_NAME"
    fi

    if command -v font-sync-vscode >/dev/null 2>&1; then
        font-sync-vscode "$FONT_NAME"
    fi

    if command -v font-sync-fuzzel >/dev/null 2>&1; then
        font-sync-fuzzel "$FONT_NAME"
    fi

    # Sync system font config
    if command -v font-sync-fontconfig >/dev/null 2>&1; then
        font-sync-fontconfig "$FONT_NAME"
    fi
}

sync_fonts

# Send notification if notify-send is available
if command -v notify-send >/dev/null 2>&1; then
    notify-send "${i18n[font_title]}" "$(msg font_switched_notify font "$FONT_NAME")"
fi
