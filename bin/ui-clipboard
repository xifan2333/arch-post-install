#!/bin/bash
# Clipboard history manager using wofi
# Usage: ui-clipboard

# Load i18n
source i18n-core

# Check if cliphist is available
if ! command -v cliphist >/dev/null 2>&1; then
    notify-send -i dialog-error "${i18n[clipboard_title]}" "${i18n[clipboard_error_not_installed]}"
    exit 1
fi

# Get clipboard history and add clear option at the top
SELECTED=$(
    {
        echo "  ${i18n[clipboard_clear_option]}"
        cliphist list
    } | ui-wofi --dmenu -p "${i18n[clipboard_prompt]}")

# User cancelled
[ -z "$SELECTED" ] && exit 0

# Check if user selected clear option
if [ "$SELECTED" = "  ${i18n[clipboard_clear_option]}" ]; then
    cliphist wipe
    notify-send -i edit-clear "${i18n[clipboard_title]}" "${i18n[clipboard_cleared]}"
    exit 0
fi

# Decode and copy selected item to clipboard
echo "$SELECTED" | cliphist decode | wl-copy
