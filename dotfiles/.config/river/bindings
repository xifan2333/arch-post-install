#!/bin/sh
# River keybindings

mod="Mod4"  # Super/Windows key

# Application launchers
riverctl map normal $mod Return spawn "uwsm app -- $TERMINAL"                                # Terminal
riverctl map normal $mod Space spawn "uwsm app -- ui-wofi"                                  # App launcher (wofi)
riverctl map normal $mod V spawn "uwsm app -- ui-clipboard"                                 # Clipboard history
riverctl map normal $mod B spawn "uwsm app -- qutebrowser"                                 # Browser
riverctl map normal $mod E spawn "uwsm app -- pcmanfm"                                      # File manager (GUI)
riverctl map normal $mod+Shift E spawn "uwsm app -- $TERMINAL -e lf"                        # File manager (TUI)
riverctl map normal $mod C spawn "uwsm app -- code"                                         # VSCode
riverctl map normal $mod G spawn "uwsm app -- ui-screenrecord"                              # Screen record

# Window management
riverctl map normal $mod W close                                    # Close window
riverctl map normal $mod F toggle-fullscreen                        # Toggle fullscreen
riverctl map normal None F11 toggle-fullscreen                      # Toggle fullscreen (F11)
riverctl map normal $mod+Shift Q exit                               # Exit River
riverctl map normal $mod+Shift R spawn river-reload                 # Reload River config

# Focus navigation (HJKL)
riverctl map normal $mod H focus-view left                          # Focus left
riverctl map normal $mod J focus-view next                          # Focus next window
riverctl map normal $mod K focus-view previous                      # Focus previous window
riverctl map normal $mod L focus-view right                         # Focus right

# Focus navigation (Arrow keys - same as JK for up/down)
riverctl map normal $mod Up focus-view previous                     # Focus previous window
riverctl map normal $mod Down focus-view next                       # Focus next window

# Window swap (HJKL)
riverctl map normal ${mod}+Shift H swap left                        # Swap left
riverctl map normal ${mod}+Shift J swap next                        # Swap with next
riverctl map normal ${mod}+Shift K swap previous                    # Swap with previous
riverctl map normal ${mod}+Shift L swap right                       # Swap right

# Window swap (Arrow keys - same as JK for up/down)
riverctl map normal ${mod}+Shift Up swap previous                   # Swap with previous
riverctl map normal ${mod}+Shift Down swap next                     # Swap with next

# Layout direction (Arrow keys - Left/Right control layout direction)
riverctl map normal ${mod}+Shift Left send-layout-cmd rivertile "main-location left"   # Horizontal layout
riverctl map normal ${mod}+Shift Right send-layout-cmd rivertile "main-location top"   # Vertical layout

# Layout control (YUIO keys)
riverctl map normal $mod Y send-layout-cmd rivertile "main-location left"        # Horizontal layout (main left)
riverctl map normal $mod U send-layout-cmd rivertile "main-location top"         # Vertical layout (main top)
riverctl map normal $mod I send-layout-cmd rivertile "main-ratio -0.05"          # Decrease main ratio
riverctl map normal $mod O send-layout-cmd rivertile "main-ratio +0.05"          # Increase main ratio

# Layout control (Arrow keys - Left/Right adjust ratio)
riverctl map normal $mod Left send-layout-cmd rivertile "main-ratio -0.05"       # Decrease main ratio
riverctl map normal $mod Right send-layout-cmd rivertile "main-ratio +0.05"      # Increase main ratio

# Window state
riverctl map normal $mod P toggle-float                             # Toggle floating
riverctl map normal $mod+Shift Return zoom                          # Zoom (swap with main)

# Multi-monitor
riverctl map normal $mod Period focus-output next                   # Focus next output
riverctl map normal $mod Comma focus-output previous                # Focus previous output
riverctl map normal ${mod}+Shift Period send-to-output next         # Send to next output
riverctl map normal ${mod}+Shift Comma send-to-output previous      # Send to previous output

# Screenshots
riverctl map normal $mod Print spawn "uwsm app -- screenshot-edit-area"                    # Screenshot area and edit
riverctl map normal ${mod}+Shift Print spawn "uwsm app -- screenshot-colorpicker"           # Color picker
riverctl map normal None Print spawn "uwsm app -- screenshot-save-area"                    # Screenshot area
riverctl map normal Shift Print spawn "uwsm app -- screenshot-save-full"                   # Screenshot full screen
riverctl map normal Control Print spawn "uwsm app -- screenshot-preview-area"              # Screenshot area and preview
riverctl map normal Mod1 Print spawn "uwsm app -- screenshot-temp-area"                    # Screenshot area to temp (copy path)

# Screen recording
riverctl map normal $mod G spawn "uwsm app -- screenrecord-start-full"                     # Record full screen
riverctl map normal ${mod}+Control G spawn "uwsm app -- screenrecord-stop"                 # Stop recording
riverctl map normal ${mod}+Mod1 G spawn "uwsm app -- screenrecord-start-area"              # Record area

# Media keys - Volume
riverctl map -repeat normal None XF86AudioRaiseVolume spawn "pamixer -i 5"
riverctl map -repeat normal None XF86AudioLowerVolume spawn "pamixer -d 5"
riverctl map normal None XF86AudioMute spawn "pamixer -t"
riverctl map normal None XF86AudioMicMute spawn "pactl set-source-mute @DEFAULT_SOURCE@ toggle"

# Media keys - Brightness
riverctl map -repeat normal None XF86MonBrightnessUp spawn "brightnessctl set +5%"
riverctl map -repeat normal None XF86MonBrightnessDown spawn "brightnessctl set 5%-"

# Media keys - Playback control
riverctl map normal None XF86AudioPlay spawn "playerctl play-pause"
riverctl map normal None XF86AudioNext spawn "playerctl next"
riverctl map normal None XF86AudioPrev spawn "playerctl previous"

# Screen lock
riverctl map normal $mod Escape spawn "uwsm app -- screen-lock"                   # Lock screen (Super + ESC)
riverctl map normal $mod+Shift W spawn "uwsm app -- screen-lock"                  # Lock screen

# Input method toggle
riverctl map normal Control Space spawn "fcitx5-remote -t"          # Toggle input method

# Tag (workspace) management
# Switch to tag 1-9
for i in $(seq 1 9); do
    # Mod+[1-9]: Focus tag N
    riverctl map normal $mod $i spawn "uwsm app -- river-workspace-focus $i"

    # Mod+Shift+[1-9]: Send focused window to tag N
    riverctl map normal ${mod}+Shift $i spawn "uwsm app -- river-workspace-send $i"

    # Mod+Control+[1-9]: Toggle visibility of tag N
    riverctl map normal ${mod}+Control $i spawn "uwsm app -- river-workspace-toggle $i"

    # Mod+Alt+[1-9]: Tag focused window with tag N (add, not move)
    riverctl map normal ${mod}+Mod1 $i spawn "uwsm app -- river-workspace-tag $i"
done

# Mod+Equal: View all normal workspaces (1-9 only, excluding scratchpad)
# Note: Equal key (=) is used because Plus (+) requires Shift
riverctl map normal $mod equal spawn "uwsm app -- river-workspace-view-all"

# Mod+Minus: Sticky window (appears on all workspaces 1-9)
riverctl map normal $mod minus spawn "uwsm app -- river-sticky"

# Scratchpad functionality (using tag 32)
# Mod+0: Toggle scratchpad visibility
riverctl map normal $mod 0 spawn "uwsm app -- river-scratchpad-toggle"

# Alt+Space: Toggle scratchpad visibility (alternative binding)
riverctl map normal Mod1 Space spawn "uwsm app -- river-scratchpad-toggle"

# Mod+Shift+0: Send focused window to scratchpad
riverctl map normal ${mod}+Shift 0 spawn "uwsm app -- river-scratchpad-send"

# Mouse bindings
riverctl map-pointer normal $mod BTN_LEFT move-view                 # Move window with mouse
riverctl map-pointer normal $mod BTN_RIGHT resize-view              # Resize window with mouse
riverctl map-pointer normal $mod BTN_MIDDLE toggle-float            # Toggle float with middle click
