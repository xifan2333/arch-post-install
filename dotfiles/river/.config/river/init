#!/bin/sh
# River init - modular configuration
# Author: xifan
# Reference: unixchad's dotfiles

# Source modular configs
RIVER_CONFIG="$HOME/.config/river"
THEME_CONFIG="$HOME/.config/theme"

# Load environment variables
[ -f "$RIVER_CONFIG/env" ] && . "$RIVER_CONFIG/env"

# Load theme colors
[ -f "$THEME_CONFIG/colors.sh" ] && . "$THEME_CONFIG/colors.sh"

. "$RIVER_CONFIG/autostart"
. "$RIVER_CONFIG/bindings"
. "$RIVER_CONFIG/rules"

# Input configuration
riverctl set-repeat 30 200
riverctl hide-cursor timeout 3000
riverctl hide-cursor when-typing enabled

# Enable touchpad tap-to-click
for i in $(riverctl list-inputs | grep -i touchpad); do
    riverctl input "$i" tap enabled
done

# Border colors
riverctl border-color-focused ${RIVER_BORDER_FOCUSED:-0x61afefff}
riverctl border-color-unfocused ${RIVER_BORDER_UNFOCUSED:-0x4b5263ff}
riverctl border-width 2

# Tags (workspaces 1-9)
for i in $(seq 1 9); do
    tags=$((1 << ($i - 1)))
    riverctl map normal $mod $i set-focused-tags $tags
    riverctl map normal ${mod}+Shift $i set-view-tags $tags
    riverctl map normal Control $i toggle-focused-tags $tags
    riverctl map normal ${mod}+Control $i toggle-view-tags $tags
done

# Layout
riverctl default-layout rivertile
rivertile -view-padding 5 -outer-padding 5 -main-ratio 0.50 &
