#!/bin/sh
# wmenu-run launcher with theme colors
# Supports toggle: pressing Super+Space again will close the launcher

# Check if wmenu is already running, if so kill it and exit
if pgrep -x wmenu-run >/dev/null || pgrep -x wmenu >/dev/null; then
    pkill -x wmenu-run
    pkill -x wmenu
    exit 0
fi

# Load wmenu common configuration
WMENU_LIB="$HOME/.dotfiles/scripts/.local/lib/wmenu-common.sh"
if [ -f "$WMENU_LIB" ]; then
    . "$WMENU_LIB"
    load_theme_colors
else
    # Fallback if lib not found - load from dotfiles source directory
    if [ -f "$HOME/.dotfiles/theme/.config/theme/colors.sh" ]; then
        . "$HOME/.dotfiles/theme/.config/theme/colors.sh"
    fi
    COLOR_BG0="${COLOR_BG0:-#282c34}"
    COLOR_FG0="${COLOR_FG0:-#abb2bf}"
    COLOR_BLUE="${COLOR_BLUE:-#61afef}"
    COLOR_GREEN="${COLOR_GREEN:-#98c379}"
fi

# Strip # from colors (wmenu expects RRGGBB format)
BG0="${COLOR_BG0#\#}"
FG0="${COLOR_FG0#\#}"
BLUE="${COLOR_BLUE#\#}"
GREEN="${COLOR_GREEN#\#}"

# Launch wmenu-run with theme colors
# Font will be read from ~/.local/lib/wmenu-common.sh
wmenu-run \
    -f "${WMENU_FONT:-Noto Sans CJK SC 13}" \
    -N "$BG0" \
    -n "$FG0" \
    -M "$BLUE" \
    -m "$BG0" \
    -S "$GREEN" \
    -s "$BG0"
