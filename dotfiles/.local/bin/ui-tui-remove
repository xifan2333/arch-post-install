#!/bin/bash
# Remove TUI .desktop entries with wofi
# List and remove installed TUI programs

# Load i18n
source "$HOME/.local/lib/lib-ui-i18n"

DESKTOP_DIR="$HOME/.local/share/applications"

# Find all TUI desktop entries
TUIS=()
while IFS= read -r -d '' file; do
    if grep -q "^Exec=.*\$TERMINAL.*-e" "$file" || grep -q "^Exec=.*alacritty.*-e" "$file"; then
        TUIS+=("$(basename "${file%.desktop}")")
    fi
done < <(find "$DESKTOP_DIR" -name '*.desktop' -print0 2>/dev/null)

if [ ${#TUIS[@]} -eq 0 ]; then
    if command -v notify-send >/dev/null 2>&1; then
        notify-send "${i18n[tui_remove_title]}" "${i18n[tui_remove_empty]}"
    fi
    echo "${i18n[tui_remove_empty]}"
    exit 0
fi

# Show selection menu
selected=$(printf '%s\n' "${TUIS[@]}" | sort | wofi --dmenu -p "${i18n[tui_remove_prompt]}")

# Exit if cancelled
[ -z "$selected" ] && exit 0

# Remove the desktop file
rm -f "$DESKTOP_DIR/$selected.desktop"

if command -v notify-send >/dev/null 2>&1; then
    notify-send "${i18n[tui_remove_title]}" "$(msg tui_remove_success app "$selected")"
fi

echo "$(msg tui_remove_success app "$selected")"
