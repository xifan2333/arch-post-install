#!/bin/bash
# Sync GTK color scheme based on current theme's mode
# This script detects if the theme is light or dark and sets GTK accordingly

set -e

CURRENT_LINK="$HOME/.config/current"

# Check if current theme symlink exists
if [ ! -L "$CURRENT_LINK" ]; then
    echo "Warning: No current theme set" >&2
    exit 1
fi

THEME_PATH=$(readlink -f "$CURRENT_LINK")
THEME_NAME=$(basename "$THEME_PATH")

# Detect if theme is light mode by checking for light.mode file
if [ -f "$THEME_PATH/light.mode" ]; then
    COLOR_SCHEME="prefer-light"
    echo "Detected light theme: $THEME_NAME"
else
    COLOR_SCHEME="prefer-dark"
    echo "Detected dark theme: $THEME_NAME"
fi

# Set GTK color scheme preference via gsettings
if command -v gsettings >/dev/null 2>&1; then
    gsettings set org.gnome.desktop.interface color-scheme "$COLOR_SCHEME"
    # Always use "Adwaita" theme name, dark variant is controlled by prefer-dark-theme
    gsettings set org.gnome.desktop.interface gtk-theme "Adwaita"
    echo "GTK color scheme set to: $COLOR_SCHEME"
    echo "GTK theme set to: Adwaita"
else
    echo "Warning: gsettings not found, skipping GTK settings" >&2
fi

echo "Theme mode synchronization complete"
