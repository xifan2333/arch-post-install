#!/bin/bash
# Set font for all applications
# Usage: lib-font-set <font-name>

set -e

# Load i18n
source "$HOME/.local/lib/lib-ui-i18n"

FONT_NAME="$1"

if [[ -z "$FONT_NAME" ]]; then
    exit 1
fi

# Check if font exists on the system
if ! fc-list | grep -iq "$FONT_NAME"; then
    exit 1
fi

# Sync fonts across applications
sync_fonts() {
    local lib_dir="$HOME/.local/lib"

    # Sync terminal emulators
    if [ -f "$lib_dir/lib-font-sync-alacritty" ]; then
        "$lib_dir/lib-font-sync-alacritty" "$FONT_NAME"
    fi

    if [ -f "$lib_dir/lib-font-sync-kitty" ]; then
        "$lib_dir/lib-font-sync-kitty" "$FONT_NAME"
    fi

    if [ -f "$lib_dir/lib-font-sync-ghostty" ]; then
        "$lib_dir/lib-font-sync-ghostty" "$FONT_NAME"
    fi

    # Sync GUI applications
    if [ -f "$lib_dir/lib-font-sync-waybar" ]; then
        "$lib_dir/lib-font-sync-waybar" "$FONT_NAME"
    fi

    if [ -f "$lib_dir/lib-font-sync-swayosd" ]; then
        "$lib_dir/lib-font-sync-swayosd" "$FONT_NAME"
    fi

    if [ -f "$lib_dir/lib-font-sync-vscode" ]; then
        "$lib_dir/lib-font-sync-vscode" "$FONT_NAME"
    fi

    if [ -f "$lib_dir/lib-font-sync-fuzzel" ]; then
        "$lib_dir/lib-font-sync-fuzzel" "$FONT_NAME"
    fi

    # Sync system font config
    if [ -f "$lib_dir/lib-font-sync-fontconfig" ]; then
        "$lib_dir/lib-font-sync-fontconfig" "$FONT_NAME"
    fi
}

sync_fonts

# Send notification if notify-send is available
if command -v notify-send >/dev/null 2>&1; then
    notify-send "${i18n[font_title]}" "$(msg font_switched_notify font "$FONT_NAME")"
fi
